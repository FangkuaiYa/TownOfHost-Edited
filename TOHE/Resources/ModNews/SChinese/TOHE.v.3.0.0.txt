#Number:100043
#Title:TownOfHostEdited Next v3.0.0
#SubTitle:★★★★反正你们也玩不了★★★★
#ShortTitle:★TOHE v3.0.0
#Date:2023-6-24T00:00:00Z
#-----------------------------
半成品，请随意


## 您需要知道的
- 由于TOH本次更新Base改动极大，TOHE几乎已经从底层重构，因此113个职业全部被重写。
- TOHE接下来的版本可能Bug数量众多，如果可以的话请您及时反馈Bug并附带日志。
- 此外根据新Base的逻辑，在原版本中的部分职业冲突的情况可能由不触发变为强制执行，
- 因此新版本TOHE在部分职业技能冲突下可能有微妙的规则差异。

## 重要
- BeipinEx框架更新：66.0.0-be.668 => 6.0.0-be.670

## 性能
- 优化击杀、灯光破坏的代码以避免部分卡顿
- 优化模组样式按钮的加载逻辑
- 优化模组选项的加载逻辑以更快地进入游戏

## 修正
- 修复名字同步模式为颜色时玩家名字可能显示为“灰色”的问题
- 修复警长、侠客等反Base职业的视野在模组端异常的问题
- 修复豺狼在模组端无法使用破坏的问题
- 修复当非主机模组端为追踪者时最总位置无法追踪的问题
- 修复模组端大厅左侧显示TOHE选项时重复显示了部分职业且布局异常的问题
- 修复量子幽灵的标记在会议上不可见的问题
- 修复观察者可以在首次会议前看到模组端玩家的CD重置碎盾动画的问题
- 修复和平之鸽重置了不该重置的技能冷却的问题
- 修复非房主模组端马里奥跳管次数与房主不同步的问题
- 修复市长手动拍灯被计入了技能使用次数的问题
- 修复对量子幽灵的击杀键互动没有被阻塞的问题
- 修复部分职业在自杀时会误触发技能的问题
- 修复部分内鬼在变形过程中召开会议导致名字显示为变形目标的名字的问题
- 修复快枪手的击杀冷却有时异常的问题
- 修复非模组端赌怪、法官与黑手党无法在会议上看到玩家ID的问题
- 修复非模组端愚者可能看不到红名的问题
- 修复非模组端可能看不到红名梦魇的问题
- 修复模组端HUD文本在死后或会议上不消失的问题
- 修复侠客在击杀失败后仍然可以继续击杀的问题
- 修复吟游诗人、狂妄杀手、贪婪者等在击杀失败后击杀冷却仍然被修改的问题
- 修复网红死亡后部分内鬼或中立可以得到通知的问题
- 修复当内鬼可击杀叛徒或叛徒可击杀内鬼选项对于部分职业无效的问题
- 修复当医生持有护盾并碎盾时若选项医生可得知目标护盾破碎启用时也会看到提示的问题
- 修复侦探、入殓师等部分职业在报告尸体时发生错误导致部分玩家职业外露的问题
- 修复部分跳管触发技能的职业不规则被弹出管道的问题
- 修复原版职业在查询时被视为隐藏职业的问题
- 修复玩家退出游戏后可能引发的一系列问题
- 修复玩家未达到房间规定等级时被连续多次踢出房间的问题
- 修复启用人满自动开始后在开始倒计时下依然显示开始按钮的问题
- 修复聊天框输入数字导致大厅的预设页面同时切换的问题
- 修复有时抹除者的技能不发动的问题
- 修复独裁发动技能时会议可能不会结束的问题
- 修复幽灵无视任务的选项可能不起作用的问题
- 修复断连玩家的任务可能任然被计入的问题
- 修复拥有跳管或变形按钮的玩家离开游戏可能造成的一些系列问题
- 修复非房主模组端显示其他玩家名字时可能错误的问题
- 修复模组端的幽幽鬼魂按钮与使用按钮有时候显示不正常的问题
- 修复模组样式按钮有时候会有一半颜色显示异常的问题
- 修复部分系统消息未被视为系统消息显示为自己发送的消息的问题
- 修复有时候非房主模组端玩家的名字变成别人的名字的问题
- 修复名字同步模式为颜色时部分非房主模组端的玩家名字显示与其实际颜色不同的问题
- 修复有时房间设置的名字后缀显示在了非房主玩家的名字下的问题
- 修复部分选项颜色与其他地方显示的颜色不同的问题
- 修复房主使用部分指令时头衔遮挡了系统消息内容的问题

## 更改
- 如果禁用了摄像头则摄像头不会亮灯
- 修改了房间自动解散倒计时的样式
- 驱逐动画被覆盖的提示在测试模式下不会显示
- 微调复盘界面的文字间距以防止其重叠
- 低负载模式暂时无效
- 模组玩家的名字在大厅中呈粉色而不是蓝色
- 模组不同的玩家的名字提示文本更大更易于分辨
- 由于不可控原因全部隐藏职业被加入选项
- 玩家在掉线后会被视为死亡以解决部分问题
- 限制部分职业的选项数值可调范围以防止部分错误
- 附加职业将启用禁用替换为生成概率而不是使用一个子选项来设定概率
- 修改附加职业的生成逻辑，附加职业不再是非黑即白地出现指定数量或完全没有，而是根据设定概率来分配数量以及玩家
- 优化防黑屏措施的计算逻辑以免在非必要的时候覆盖了驱逐动画
- 直播模式下房间号显示的样式微调
- 主菜单UI优化与微调
- 马模式按钮从主菜单移动至设置选项
- 赌怪猜测界面放大、添加打开过渡动画以及选项卡的样式修改
- 移除“TOHE大家族”界面并将原内容显示在AmongUs官方开发人员界面
- 右上角Ping显示区域微调并显示帧数
- 修改云公告的窗口大小以适应公告内容
- 降低更新时进度显示频率以防止卡死进程或闪退
- 模组端管理员或死亡玩家打开地图默认显示所有人位置（管理室地图）
- 模组端的聊天信息可以显示彩色文本了
- 模组端的聊天消息字数上限修改（房主999，非房主300）
- 来自模组的特殊消息将会将消息气泡显示为黑色背景以便于区分
- 大厅左侧更小的选项预览字体以在一页显示更多的内容
- 创作者素材保护计划 => 导演模式（允许房主指定自己下局的职业）
- 非TOHE房间的时候右上角不会继续显示其他信息
- 微调开局职业显示界面的字体（为了模组的辨识度 :p）
- 将开局职业显示文本覆盖的速度调快以防止高帧数情况下出现几帧未覆盖文本的情况
- 主动叛变模式下自票事件会被阻塞并允许您重新投票
- 修改了公告与模组更新界面
- 大部分游戏原界面按钮的配色由绿色换为粉色
- 重新排版系统设置面板为其分类并上色

## 删除
- 选项：快速启动模式（已针对启动速度进行优化）
- /s 指令（请使用快捷键选择发送目标代替）
- 选项：隐藏市长附加的投票（因技能发动方式修改不再需要）
- 选项：隐藏占卜师的投票（因技能发动方式修改不再需要）
- 选项：隐藏抹除者的投票（因技能发动方式修改不再需要）
- 贡献者消息
- 贡献者与开发者的头衔（将添加至新自定义头衔系统的默认加载项）

## 新增
- 当房主掉线时自动结束游戏并显示“伪装者已断线”
- 选项：禁用移动平台（飞艇地图）
- 用于取消开始倒计时的按钮
- 选项：幽灵可见他人任务（区别于幽灵可见他人职业）
- 设置选项切换原版的确认界面
- 设置选项：输出日志
- 当狙击手未能击杀目标时提醒狙击手
- 当术士操控的目标未能击杀其他玩家时提醒术士
- 模组端可以看到其他玩家被踢出的原因例如等级不足、作弊、使用违禁词等
- 模组端玩家被踢出后通过弹窗显示被踢的原因
- 当被害妄想症达到技能使用上限时进行提示
- 所有通用附加职业可以设定在每个支持阵营的最大数量
- 所有通用附加职业可以设定强制分配给某个主职业
- 为豺狼恢复冷却时增加提示
- 为非模组端嗜血骑士增加免疫生效的持续提示
- 为呪狼的反杀成功增加提示
- 为赝品商增加重复出售的提示
- 赝品商可以看到客户的名字旁出现“▲”标记
- 为主菜单的部分按钮和组件添加交互动效
- 设置选项：游戏结束后自动返回大厅
- 一键更新模组会显示部分无法更细的原因
- Skeld地图的保安室桌子上新增一个按钮用于切换显示万圣节的装扮
- 模板文件（欢迎消息与会议开始消息等）现在默认是彩色的了
- 房主按住Shift可以将消息发送给所有人
- 房主按住Ctrl可以将消息发送给所有死亡玩家
- 大厅时使用Ctrl+Tab切换至上一页预设显示
- 大厅的预设显示对每一页进行分类（原版设置/启用职业/内鬼职业/船员职业/中立职业/附加职业/游戏设置/系统设置）
- 大厅的预设显示可以使用滚轮向下滑动（不会影响到视野缩放）
- 打字时自动将不支持的字符替换为支持的字符以便于您不再需要一直切换中英输入
- 检查 Among Us 版本是否支持
- 模组端占卜师可以通过弹窗显示占卜结果
- 模组端抹除者可以通过弹窗显示抹除结果
- 检查更新失败会进行提示并允许玩家重试
- 更新失败会显示失败原因并提示可能的解决方法
- 自定义头衔管理系统以及完善的设置界面（在主菜单选项里）
- 选项：允许玩家携带彩色名字（自定义头衔系统）进入游戏
- 选项：为非模组端玩家应用多行头衔（会导致消息被挡）

## 角色更改
- 所有技能优先度变更，故部分职业互发动技能与往常稍有区别，请自行测试，请反馈您认为不合理的变更，因为这些改版并不是我们故意也不受我们控制。我们会在接受反馈后尽快修改恢复
- 梦魇的技能以及红名会在灯光破坏的4秒后发动而不是立刻发动
- 烟花商人引爆烟花不再有冷却
- 网红现在可以成为叛徒（叛徒网红技能改为所有人可知网红死亡）
- 老兵现在可以反伤一些使其被动自杀的技能例如吸血鬼、船鬼等
- 医生的护盾现在可以避免一些原本不能抵挡的伤害
- 嗜血骑士的技能现在可以避免一些原本不能抵挡的伤害
- 幸运儿的技能现在可以避免一些原本不能抵挡的伤害
- 独裁者可以进行正常投票并通过连续两次投票给相同玩家触发技能
- 占卜师占卜不计票并可以在占卜完成或占卜次数耗尽后正常投票
- 抹除者抹除不计票并可以在抹除发动或抹除次数耗尽后正常投票